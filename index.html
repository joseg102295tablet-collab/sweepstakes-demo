https://msuazeiejmwsyxbxzwmt.supabase.co
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1zdWF6ZWllam13c3l4Ynh6d210Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MDAzMDUsImV4cCI6MjA3Mjk3NjMwNX0.YeNa7lDOmimwLU_M1fd-8quu-Cj8folmVC_MNZBhTqE
<!doctype html> <html lang="en"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>Sweepstakes Fish/Slots Demo</title> <style> body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 16px; background: #0b1324; color: #f5f7ff; } .card { max-width: 680px; margin: 0 auto; background: #111a33; border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.3); } h1 { margin: 0 0 8px; font-size: 24px; } label { display: block; margin: 12px 0 4px; font-size: 14px; opacity: .85; } input, button { width: 100%; font-size: 16px; padding: 12px; border-radius: 10px; border: 1px solid #2c3e75; background: #0f1730; color: #fff; } button { background: #1f2a55; border: none; margin-top: 10px; } button:active { transform: scale(.99); } .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; } .reels { font-size: 48px; text-align: center; padding: 12px; background: #0f1730; border-radius: 12px; margin: 12px 0; letter-spacing: 8px; } .credits { font-size: 18px; margin-top: 8px; } .hidden { display: none; } a { color: #7db0ff; } .notice { font-size: 12px; opacity: .8; margin-top: 12px; } </style> </head> <body> <div class="card"> <h1>üêü Sweepstakes Demo (Slots)</h1> <div id="auth-view"> <p>Sign in with a magic link. No password needed.</p> <label for="email">Email</label> <input id="email" type="email" placeholder="you@example.com" /> <button id="loginBtn">Send magic link</button> <p class="notice">After you tap the magic link in your email, you‚Äôll return here signed in.</p> </div> <div id="app-view" class="hidden"> <div class="row"> <div> <div class="credits">Credits: <span id="credits">‚Äî</span></div> </div> <div style="text-align:right"> <button id="logoutBtn">Log out</button> </div> </div> <div class="reels" id="reels">üé∞ üé∞ üé∞</div> <label for="bet">Bet (1‚Äì1000)</label> <input id="bet" type="number" value="10" min="1" max="1000" /> <button id="spinBtn">Spin</button> <p id="result" class="notice"></p> <hr style="border-color:#2c3e75; opacity:.3; margin:16px 0" /> <p><a id="rulesLink" href="#" target="_blank" rel="noopener">Sweepstakes Rules (PDF)</a></p> <p class="notice">Demo only. No real money. Odds and payouts are for testing.</p> </div> </div> <script type="module"> import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'; // TODO: paste your actual values in ¬ß4 const SUPABASE_URL = 'YOUR_SUPABASE_URL'; const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY'; const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY); const authView = document.getElementById('auth-view'); const appView = document.getElementById('app-view'); const loginBtn = document.getElementById('loginBtn'); const logoutBtn = document.getElementById('logoutBtn'); const emailInput = document.getElementById('email'); const creditsEl = document.getElementById('credits'); const reelsEl = document.getElementById('reels'); const spinBtn = document.getElementById('spinBtn'); const betInput = document.getElementById('bet'); const resultEl = document.getElementById('result'); const rulesLink = document.getElementById('rulesLink'); // Replace this after you upload PDF in ¬ß6 let RULES_URL = '#'; rulesLink.href = RULES_URL; async function refreshUI() { const { data: { session } } = await supabase.auth.getSession(); if (session) { authView.classList.add('hidden'); appView.classList.remove('hidden'); await loadCredits(); } else { appView.classList.add('hidden'); authView.classList.remove('hidden'); } } async function loadCredits() { const { data: { user } } = await supabase.auth.getUser(); if (!user) return; const { data, error } = await supabase.from('profiles').select('credits').eq('id', user.id).single(); if (error) { creditsEl.textContent = '‚Äî'; } else { creditsEl.textContent = data.credits; } } loginBtn?.addEventListener('click', async () => { const email = emailInput.value.trim(); if (!email) { alert('Enter an email'); return; } const { error } = await supabase.auth.signInWithOtp({ email, options: { emailRedirectTo: window.location.href } }); if (error) alert(error.message); else alert('Magic link sent! Check your email.'); }); logoutBtn?.addEventListener('click', async () => { await supabase.auth.signOut(); await refreshUI(); }); spinBtn?.addEventListener('click', async () => { resultEl.textContent = 'Spinning...'; const bet = parseInt(betInput.value, 10); if (!Number.isFinite(bet) || bet < 1 || bet > 1000) { alert('Bet must be 1‚Äì1000'); return; } const { data: { session } } = await supabase.auth.getSession(); if (!session) { alert('Please sign in'); return; } const res = await fetch('/api/play', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session.access_token}` }, body: JSON.stringify({ bet }) }); const json = await res.json(); if (!res.ok) { resultEl.textContent = json.error || 'Error'; return; } reelsEl.textContent = `${json.reels[0]} ${json.reels[1]} ${json.reels[2]}`; resultEl.textContent = `${json.outcome} ‚Äî Won ${json.win}, New credits: ${json.credits}`; creditsEl.textContent = json.credits; }); supabase.auth.onAuthStateChange(async () => { await refreshUI(); }); refreshUI(); </script> </body> </html> 
Tap Commit new file.
B) api/play.js (serverless function)
‚Ä¢ Tap Add file > Create new file
‚Ä¢ In the filename box, type exactly: api/play.js (GitHub will create the api/ folder automatically)
‚Ä¢ Paste:
import { createClient } from '@supabase/supabase-js'; import crypto from 'crypto'; const supabase = createClient( process.env.SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY ); export default async function handler(req, res) { if (req.method !== 'POST') { res.status(405).json({ error: 'Method not allowed' }); return; } try { const authHeader = req.headers.authorization || ''; const token = authHeader.startsWith('Bearer ') ? authHeader.slice(7) : null; if (!token) return res.status(401).json({ error: 'Missing token' }); const { data: userData, error: userErr } = await supabase.auth.getUser(token); if (userErr || !userData?.user) return res.status(401).json({ error: 'Invalid token' }); const userId = userData.user.id; const { bet } = req.body || {}; const betInt = parseInt(bet, 10); if (!Number.isFinite(betInt) || betInt < 1 || betInt > 1000) { return res.status(400).json({ error: 'Invalid bet' }); } // Fetch current credits const { data: profile, error: profErr } = await supabase .from('profiles') .select('credits') .eq('id', userId) .single(); if (profErr) return res.status(500).json({ error: 'Profile fetch failed' }); if ((profile?.credits ?? 0) < betInt) return res.status(400).json({ error: 'Not enough credits' }); // RNG reels using crypto const symbols = ['üêü','ü¶ê','ü¶Ä','üêô','üé£','üíé','7Ô∏è‚É£','‚≠ê','üçÄ']; const pick = () => symbols[crypto.randomInt(0, symbols.length)]; const reels = [pick(), pick(), pick()]; let multiplier = 0; const allSame = (reels[0] === reels[1] && reels[1] === reels[2]); const twoSame = (reels[0] === reels[1] || reels[1] === reels[2] || reels[0] === reels[2]); if (allSame) { if (reels[0] === '7Ô∏è‚É£') multiplier = 20; else if (reels[0] === 'üíé') multiplier = 15; else multiplier = 10; } else if (twoSame) { multiplier = 2; } else { multiplier = 0; } const win = betInt * multiplier; const outcome = multiplier >= 10 ? 'JACKPOT' : (multiplier > 0 ? 'WIN' : 'LOSE'); // Update credits (simple demo ‚Äî not handling concurrent spins) const newCredits = profile.credits - betInt + win; const { error: updErr } = await supabase .from('profiles') .update({ credits: newCredits }) .eq('id', userId); if (updErr) return res.status(500).json({ error: 'Credit update failed' }); // Insert play record await supabase.from('plays').insert({ user_id: userId, bet: betInt, reels, outcome, win }); res.status(200).json({ reels, outcome, win, credits: newCredits }); } catch (e) { res.status(500).json({ error: 'Server error' }); } } 
